@page "/"
@inject IGameManifestRepository _gameManifestRepository
@inject IGameScriptLoader _gameScriptLoader
@inject NavigationManager _navigationManager;

<h1>Game-a-Tron 4000</h1>

<ul>
@foreach (var manifest in _manifests)
{
    <li @onclick="@(() => OnGameSelected(manifest))">@manifest.Metadata.Name</li>
}
</ul>

@code
{
    private IEnumerable<GameManifest> _manifests = Enumerable.Empty<GameManifest>();

    protected override async Task OnInitializedAsync()
    {
        // The GameScriptLoader can start initializing while the player is
        // still selecting a game.
        var _ = _gameScriptLoader.PreloadAsync();

        _manifests = await _gameManifestRepository.LoadGameManifestsAsync();
    }

    private void OnGameSelected(GameManifest manifest)
    {
        _navigationManager.NavigateTo($"game/{manifest.DiskNumber}");
    }
}
